"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return Consequence;
    }
});
var _array = require("./utilities/array");
var _string = require("./utilities/string");
var _query = require("./utilities/query");
var _ruleNames = require("./ruleNames");
function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}
function _defineProperties(target, props) {
    for(var i = 0; i < props.length; i++){
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
    }
}
function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
}
var Consequence = /*#__PURE__*/ function() {
    function Consequence(statementNode) {
        _classCallCheck(this, Consequence);
        this.statementNode = statementNode;
    }
    _createClass(Consequence, [
        {
            key: "getStatementNode",
            value: function getStatementNode() {
                return this.statementNode;
            }
        },
        {
            key: "matchStatementNode",
            value: function matchStatementNode(statementNode, metaSubstitutions) {
                var nonTerminalNode = statementNode, consequenceNonTerminalNode = this.statementNode, consequenceNonTerminalNodeMatches = matchConsequenceNonTerminalNode(consequenceNonTerminalNode, nonTerminalNode, metaSubstitutions), statementNodeMatches = consequenceNonTerminalNodeMatches; ///
                return statementNodeMatches;
            }
        },
        {
            key: "toJSON",
            value: function toJSON() {
                var statementString = (0, _string.nodeAsString)(this.statementNode), statement = statementString, json = {
                    statement: statement
                };
                return json;
            }
        }
    ], [
        {
            key: "fromJSON",
            value: function fromJSON(json, releaseContext) {
                var statement = json.statement, statementString = statement, statementNode = (0, _string.statementNodeFromStatementString)(statementString, releaseContext), consequence = new Consequence(statementNode);
                return consequence;
            }
        },
        {
            key: "fromStatementNode",
            value: function fromStatementNode(statementNode) {
                var consequence = new Consequence(statementNode);
                return consequence;
            }
        }
    ]);
    return Consequence;
}();
function matchConsequenceNode(consequenceNode, node, metaSubstitutions) {
    var consequenceNodeMatches = false;
    var nodeTerminalNode = node.isTerminalNode(), ruleNodeTerminalNode = consequenceNode.isTerminalNode();
    if (nodeTerminalNode === ruleNodeTerminalNode) {
        if (nodeTerminalNode) {
            var terminalNode = node, consequenceTerminalNode = consequenceNode, consequenceTerminalNodeMatches = matchConsequenceTerminalNode(consequenceTerminalNode, terminalNode, metaSubstitutions);
            consequenceNodeMatches = consequenceTerminalNodeMatches; ///
        } else {
            var nonTerminalNode = node, consequenceNonTerminalNode = consequenceNode, consequenceNonTerminalNodeMatches = matchConsequenceNonTerminalNode(consequenceNonTerminalNode, nonTerminalNode, metaSubstitutions);
            consequenceNodeMatches = consequenceNonTerminalNodeMatches; ///
        }
    }
    return consequenceNodeMatches;
}
function matchConsequenceNodes(consequenceNodes, nodes, metaSubstitutions) {
    var consequenceNodesMatches = false;
    var nodesLength = nodes.length, consequenceNodesLength = consequenceNodes.length;
    if (nodesLength === consequenceNodesLength) {
        consequenceNodesMatches = nodes.every(function(node, index) {
            var consequenceNode = consequenceNodes[index], consequenceNodeMatches = matchConsequenceNode(consequenceNode, node, metaSubstitutions);
            if (consequenceNodeMatches) {
                return true;
            }
        });
    }
    return consequenceNodesMatches;
}
function matchConsequenceVariable(consequenceVariableNode, nodes, metaSubstitutions) {
    var consequenceVariableMatches = true;
    var consequenceVariableName = (0, _query.variableNameFromVariableNode)(consequenceVariableNode), metaSubstitution = metaSubstitutions.find(function(metaSubstitution) {
        var variableName = metaSubstitution.getVariableName();
        if (variableName === consequenceVariableName) {
            return true;
        }
    }) || null;
    if (metaSubstitution !== null) {
        var metaSubstitutionNodesMatch = metaSubstitution.matchNodes(nodes);
        consequenceVariableMatches = metaSubstitutionNodesMatch; ///
    }
    return consequenceVariableMatches;
}
function matchConsequenceTerminalNode(consequenceTerminalNode, terminalNode, metaSubstitutions) {
    var matches = consequenceTerminalNode.match(terminalNode), consequenceTerminalNodeMatches = matches; ///
    return consequenceTerminalNodeMatches;
}
function matchConsequenceNonTerminalNode(consequenceNonTerminalNode, nonTerminalNode, metaSubstitutions) {
    var consequenceNonTerminalNodeMatches = false;
    var ruleName = nonTerminalNode.getRuleName(), consequenceRuleName = consequenceNonTerminalNode.getRuleName(); ///
    if (ruleName === consequenceRuleName) {
        var childNodes = nonTerminalNode.getChildNodes(), consequenceChildNodes = consequenceNonTerminalNode.getChildNodes(), nodes = childNodes, consequenceNodes = consequenceChildNodes, consequenceChildNodesMatches = matchConsequenceNodes(consequenceNodes, nodes, metaSubstitutions);
        consequenceNonTerminalNodeMatches = consequenceChildNodesMatches; ///
        if (!consequenceNonTerminalNodeMatches) {
            var ruleNameStatementRuleName = ruleName === _ruleNames.STATEMENT_RULE_NAME;
            if (ruleNameStatementRuleName) {
                var statementNode = nonTerminalNode, consequenceStatementNode = consequenceNonTerminalNode, consequenceStatementNodeMatches = matchConsequenceStatementNode(consequenceStatementNode, statementNode, metaSubstitutions);
                consequenceNonTerminalNodeMatches = consequenceStatementNodeMatches; ///
            }
        }
    }
    return consequenceNonTerminalNodeMatches;
}
function matchConsequenceStatementNode(consequenceStatementNode, statementNode, metaSubstitutions) {
    var consequenceStatementNodeMatches = false;
    var consequenceNonTerminalNode = consequenceStatementNode, consequenceChildNodes = consequenceNonTerminalNode.getChildNodes(), consequenceChildNodesLength = consequenceChildNodes.length;
    if (consequenceChildNodesLength === 1) {
        var firstConsequenceChildNode = (0, _array.first)(consequenceChildNodes), consequenceChildNode = firstConsequenceChildNode, consequenceChildNodeNonTerminalNode = consequenceChildNode.isNonTerminalNode();
        if (consequenceChildNodeNonTerminalNode) {
            var consequenceNonTerminalChildNode = consequenceChildNode, consequenceNonTerminalChildNodeRuleName = consequenceNonTerminalChildNode.getRuleName(), consequenceNonTerminalChildNodeRuleNameVariableRuleName = consequenceNonTerminalChildNodeRuleName === _ruleNames.VARIABLE_RULE_NAME;
            if (consequenceNonTerminalChildNodeRuleNameVariableRuleName) {
                var consequenceVariableNode = consequenceNonTerminalChildNode, nonTerminalNode = statementNode, childNodes = nonTerminalNode.getChildNodes(), nodes = childNodes, consequenceMetaVariableMatches = matchConsequenceVariable(consequenceVariableNode, nodes, metaSubstitutions);
                consequenceStatementNodeMatches = consequenceMetaVariableMatches; ///
            }
        }
    }
    return consequenceStatementNodeMatches;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25zZXF1ZW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgZmlyc3QgfSBmcm9tIFwiLi91dGlsaXRpZXMvYXJyYXlcIjtcbmltcG9ydCB7IG5vZGVBc1N0cmluZyB9IGZyb20gXCIuL3V0aWxpdGllcy9zdHJpbmdcIjtcbmltcG9ydCB7IHZhcmlhYmxlTmFtZUZyb21WYXJpYWJsZU5vZGUgfSBmcm9tIFwiLi91dGlsaXRpZXMvcXVlcnlcIjtcbmltcG9ydCB7IHN0YXRlbWVudE5vZGVGcm9tU3RhdGVtZW50U3RyaW5nIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3N0cmluZ1wiO1xuaW1wb3J0IHsgVkFSSUFCTEVfUlVMRV9OQU1FLCBTVEFURU1FTlRfUlVMRV9OQU1FIH0gZnJvbSBcIi4vcnVsZU5hbWVzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENvbnNlcXVlbmNlIHtcbiAgY29uc3RydWN0b3Ioc3RhdGVtZW50Tm9kZSkge1xuICAgIHRoaXMuc3RhdGVtZW50Tm9kZSA9IHN0YXRlbWVudE5vZGU7XG4gIH1cblxuICBnZXRTdGF0ZW1lbnROb2RlKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXRlbWVudE5vZGU7XG4gIH1cblxuICBtYXRjaFN0YXRlbWVudE5vZGUoc3RhdGVtZW50Tm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBzdGF0ZW1lbnROb2RlLCAgLy8vXG4gICAgICAgICAgY29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGUgPSB0aGlzLnN0YXRlbWVudE5vZGUsICAvLy9cbiAgICAgICAgICBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZU1hdGNoZXMgPSBtYXRjaENvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlKGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlLCBub25UZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKSxcbiAgICAgICAgICBzdGF0ZW1lbnROb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlTWF0Y2hlczsgLy8vXG5cbiAgICByZXR1cm4gc3RhdGVtZW50Tm9kZU1hdGNoZXM7XG4gIH1cblxuICB0b0pTT04oKSB7XG4gICAgY29uc3Qgc3RhdGVtZW50U3RyaW5nID0gbm9kZUFzU3RyaW5nKHRoaXMuc3RhdGVtZW50Tm9kZSksXG4gICAgICAgICAgc3RhdGVtZW50ID0gc3RhdGVtZW50U3RyaW5nLCAgLy8vXG4gICAgICAgICAganNvbiA9IHtcbiAgICAgICAgICAgIHN0YXRlbWVudFxuICAgICAgICAgIH07XG5cbiAgICByZXR1cm4ganNvbjtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tSlNPTihqc29uLCByZWxlYXNlQ29udGV4dCkge1xuICAgIGNvbnN0IHsgc3RhdGVtZW50IH0gPSBqc29uLFxuICAgICAgICAgIHN0YXRlbWVudFN0cmluZyA9IHN0YXRlbWVudCwgIC8vL1xuICAgICAgICAgIHN0YXRlbWVudE5vZGUgPSBzdGF0ZW1lbnROb2RlRnJvbVN0YXRlbWVudFN0cmluZyhzdGF0ZW1lbnRTdHJpbmcsIHJlbGVhc2VDb250ZXh0KSxcbiAgICAgICAgICBjb25zZXF1ZW5jZSA9IG5ldyBDb25zZXF1ZW5jZShzdGF0ZW1lbnROb2RlKTtcblxuICAgIHJldHVybiBjb25zZXF1ZW5jZTtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tU3RhdGVtZW50Tm9kZShzdGF0ZW1lbnROb2RlKSB7XG4gICAgY29uc3QgY29uc2VxdWVuY2UgPSBuZXcgQ29uc2VxdWVuY2Uoc3RhdGVtZW50Tm9kZSk7XG5cbiAgICByZXR1cm4gY29uc2VxdWVuY2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gbWF0Y2hDb25zZXF1ZW5jZU5vZGUoY29uc2VxdWVuY2VOb2RlLCBub2RlLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVuY2VOb2RlTWF0Y2hlcyA9IGZhbHNlO1xuXG4gIGNvbnN0IG5vZGVUZXJtaW5hbE5vZGUgPSBub2RlLmlzVGVybWluYWxOb2RlKCksXG4gICAgICAgIHJ1bGVOb2RlVGVybWluYWxOb2RlID0gY29uc2VxdWVuY2VOb2RlLmlzVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVUZXJtaW5hbE5vZGUgPT09IHJ1bGVOb2RlVGVybWluYWxOb2RlKSB7XG4gICAgaWYgKG5vZGVUZXJtaW5hbE5vZGUpIHtcbiAgICAgIGNvbnN0IHRlcm1pbmFsTm9kZSA9IG5vZGUsICAvLy9cbiAgICAgICAgICAgIGNvbnNlcXVlbmNlVGVybWluYWxOb2RlID0gY29uc2VxdWVuY2VOb2RlLCAgLy8vXG4gICAgICAgICAgICBjb25zZXF1ZW5jZVRlcm1pbmFsTm9kZU1hdGNoZXMgPSBtYXRjaENvbnNlcXVlbmNlVGVybWluYWxOb2RlKGNvbnNlcXVlbmNlVGVybWluYWxOb2RlLCB0ZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKTtcblxuICAgICAgY29uc2VxdWVuY2VOb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbmNlVGVybWluYWxOb2RlTWF0Y2hlczsgIC8vL1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICAgIGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlID0gY29uc2VxdWVuY2VOb2RlLCAgLy8vXG4gICAgICAgICAgICBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZU1hdGNoZXMgPSBtYXRjaENvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlKGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlLCBub25UZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKTtcblxuICAgICAgY29uc2VxdWVuY2VOb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlTWF0Y2hlczsgLy8vXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNvbnNlcXVlbmNlTm9kZU1hdGNoZXM7XG59XG5cbmZ1bmN0aW9uIG1hdGNoQ29uc2VxdWVuY2VOb2Rlcyhjb25zZXF1ZW5jZU5vZGVzLCBub2RlcywgbWV0YVN1YnN0aXR1dGlvbnMpIHtcbiAgbGV0IGNvbnNlcXVlbmNlTm9kZXNNYXRjaGVzID0gZmFsc2U7XG5cbiAgY29uc3Qgbm9kZXNMZW5ndGggPSBub2Rlcy5sZW5ndGgsXG4gICAgICAgIGNvbnNlcXVlbmNlTm9kZXNMZW5ndGggPSBjb25zZXF1ZW5jZU5vZGVzLmxlbmd0aDtcblxuICBpZiAobm9kZXNMZW5ndGggPT09IGNvbnNlcXVlbmNlTm9kZXNMZW5ndGgpIHtcbiAgICBjb25zZXF1ZW5jZU5vZGVzTWF0Y2hlcyA9IG5vZGVzLmV2ZXJ5KChub2RlLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY29uc2VxdWVuY2VOb2RlID0gY29uc2VxdWVuY2VOb2Rlc1tpbmRleF0sXG4gICAgICAgICAgICBjb25zZXF1ZW5jZU5vZGVNYXRjaGVzID0gbWF0Y2hDb25zZXF1ZW5jZU5vZGUoY29uc2VxdWVuY2VOb2RlLCBub2RlLCBtZXRhU3Vic3RpdHV0aW9ucyk7XG5cbiAgICAgIGlmIChjb25zZXF1ZW5jZU5vZGVNYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGNvbnNlcXVlbmNlTm9kZXNNYXRjaGVzO1xufVxuXG5mdW5jdGlvbiBtYXRjaENvbnNlcXVlbmNlVmFyaWFibGUoY29uc2VxdWVuY2VWYXJpYWJsZU5vZGUsIG5vZGVzLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVuY2VWYXJpYWJsZU1hdGNoZXMgPSB0cnVlO1xuXG4gIGNvbnN0IGNvbnNlcXVlbmNlVmFyaWFibGVOYW1lID0gdmFyaWFibGVOYW1lRnJvbVZhcmlhYmxlTm9kZShjb25zZXF1ZW5jZVZhcmlhYmxlTm9kZSksXG4gICAgICAgIG1ldGFTdWJzdGl0dXRpb24gPSBtZXRhU3Vic3RpdHV0aW9ucy5maW5kKChtZXRhU3Vic3RpdHV0aW9uKSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFyaWFibGVOYW1lID0gbWV0YVN1YnN0aXR1dGlvbi5nZXRWYXJpYWJsZU5hbWUoKTtcblxuICAgICAgICAgIGlmICh2YXJpYWJsZU5hbWUgPT09IGNvbnNlcXVlbmNlVmFyaWFibGVOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pIHx8IG51bGw7XG5cbiAgaWYgKG1ldGFTdWJzdGl0dXRpb24gIT09IG51bGwpIHtcbiAgICBjb25zdCBtZXRhU3Vic3RpdHV0aW9uTm9kZXNNYXRjaCA9IG1ldGFTdWJzdGl0dXRpb24ubWF0Y2hOb2Rlcyhub2Rlcyk7XG5cbiAgICBjb25zZXF1ZW5jZVZhcmlhYmxlTWF0Y2hlcyA9IG1ldGFTdWJzdGl0dXRpb25Ob2Rlc01hdGNoOyAgLy8vXG4gIH1cblxuICByZXR1cm4gY29uc2VxdWVuY2VWYXJpYWJsZU1hdGNoZXM7XG59XG5cbmZ1bmN0aW9uIG1hdGNoQ29uc2VxdWVuY2VUZXJtaW5hbE5vZGUoY29uc2VxdWVuY2VUZXJtaW5hbE5vZGUsIHRlcm1pbmFsTm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpIHtcbiAgY29uc3QgbWF0Y2hlcyA9IGNvbnNlcXVlbmNlVGVybWluYWxOb2RlLm1hdGNoKHRlcm1pbmFsTm9kZSksXG4gICAgICAgIGNvbnNlcXVlbmNlVGVybWluYWxOb2RlTWF0Y2hlcyA9IG1hdGNoZXM7ICAvLy9cblxuICByZXR1cm4gY29uc2VxdWVuY2VUZXJtaW5hbE5vZGVNYXRjaGVzO1xufVxuXG5mdW5jdGlvbiBtYXRjaENvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlKGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlLCBub25UZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKSB7XG4gIGxldCBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZU1hdGNoZXMgPSBmYWxzZTtcblxuICBjb25zdCBydWxlTmFtZSA9IG5vblRlcm1pbmFsTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICBjb25zZXF1ZW5jZVJ1bGVOYW1lID0gY29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGUuZ2V0UnVsZU5hbWUoKTsgLy8vXG5cbiAgaWYgKHJ1bGVOYW1lID09PSBjb25zZXF1ZW5jZVJ1bGVOYW1lKSB7XG4gICAgY29uc3QgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgICAgY29uc2VxdWVuY2VDaGlsZE5vZGVzID0gY29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICAgIG5vZGVzID0gY2hpbGROb2RlcywgLy8vXG4gICAgICAgICAgY29uc2VxdWVuY2VOb2RlcyA9IGNvbnNlcXVlbmNlQ2hpbGROb2RlcywgLy8vXG4gICAgICAgICAgY29uc2VxdWVuY2VDaGlsZE5vZGVzTWF0Y2hlcyA9IG1hdGNoQ29uc2VxdWVuY2VOb2Rlcyhjb25zZXF1ZW5jZU5vZGVzLCBub2RlcywgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgY29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGVNYXRjaGVzID0gY29uc2VxdWVuY2VDaGlsZE5vZGVzTWF0Y2hlczsgLy8vXG5cbiAgICBpZiAoIWNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlTWF0Y2hlcykge1xuICAgICAgY29uc3QgcnVsZU5hbWVTdGF0ZW1lbnRSdWxlTmFtZSA9IChydWxlTmFtZSA9PT0gU1RBVEVNRU5UX1JVTEVfTkFNRSk7XG5cbiAgICAgIGlmIChydWxlTmFtZVN0YXRlbWVudFJ1bGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlbWVudE5vZGUgPSBub25UZXJtaW5hbE5vZGUsICAvLy9cbiAgICAgICAgICAgICAgY29uc2VxdWVuY2VTdGF0ZW1lbnROb2RlID0gY29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGUsICAvLy9cbiAgICAgICAgICAgICAgY29uc2VxdWVuY2VTdGF0ZW1lbnROb2RlTWF0Y2hlcyA9IG1hdGNoQ29uc2VxdWVuY2VTdGF0ZW1lbnROb2RlKGNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZSwgc3RhdGVtZW50Tm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgICAgIGNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZU1hdGNoZXM7IC8vL1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZU1hdGNoZXM7XG59XG5cbmZ1bmN0aW9uIG1hdGNoQ29uc2VxdWVuY2VTdGF0ZW1lbnROb2RlKGNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZSwgc3RhdGVtZW50Tm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpIHtcbiAgbGV0IGNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZU1hdGNoZXMgPSBmYWxzZTtcblxuICBjb25zdCBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZSA9IGNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZSwgIC8vL1xuICAgICAgICBjb25zZXF1ZW5jZUNoaWxkTm9kZXMgPSBjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgIGNvbnNlcXVlbmNlQ2hpbGROb2Rlc0xlbmd0aCA9IGNvbnNlcXVlbmNlQ2hpbGROb2Rlcy5sZW5ndGg7XG5cbiAgaWYgKGNvbnNlcXVlbmNlQ2hpbGROb2Rlc0xlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IGZpcnN0Q29uc2VxdWVuY2VDaGlsZE5vZGUgPSBmaXJzdChjb25zZXF1ZW5jZUNoaWxkTm9kZXMpLFxuICAgICAgICAgIGNvbnNlcXVlbmNlQ2hpbGROb2RlID0gZmlyc3RDb25zZXF1ZW5jZUNoaWxkTm9kZSwgIC8vL1xuICAgICAgICAgIGNvbnNlcXVlbmNlQ2hpbGROb2RlTm9uVGVybWluYWxOb2RlID0gY29uc2VxdWVuY2VDaGlsZE5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICAgIGlmIChjb25zZXF1ZW5jZUNoaWxkTm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgICAgY29uc3QgY29uc2VxdWVuY2VOb25UZXJtaW5hbENoaWxkTm9kZSA9IGNvbnNlcXVlbmNlQ2hpbGROb2RlLCAgLy8vXG4gICAgICAgICAgICBjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWUgPSBjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICBjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWVWYXJpYWJsZVJ1bGVOYW1lID0gKGNvbnNlcXVlbmNlTm9uVGVybWluYWxDaGlsZE5vZGVSdWxlTmFtZSA9PT0gVkFSSUFCTEVfUlVMRV9OQU1FKTtcblxuICAgICAgaWYgKGNvbnNlcXVlbmNlTm9uVGVybWluYWxDaGlsZE5vZGVSdWxlTmFtZVZhcmlhYmxlUnVsZU5hbWUpIHtcbiAgICAgICAgY29uc3QgY29uc2VxdWVuY2VWYXJpYWJsZU5vZGUgPSBjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlLCAgLy8vXG4gICAgICAgICAgICAgIG5vblRlcm1pbmFsTm9kZSA9IHN0YXRlbWVudE5vZGUsICAvLy9cbiAgICAgICAgICAgICAgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgICAgICAgIG5vZGVzID0gY2hpbGROb2RlcywgLy8vXG4gICAgICAgICAgICAgIGNvbnNlcXVlbmNlTWV0YVZhcmlhYmxlTWF0Y2hlcyA9IG1hdGNoQ29uc2VxdWVuY2VWYXJpYWJsZShjb25zZXF1ZW5jZVZhcmlhYmxlTm9kZSwgbm9kZXMsIG1ldGFTdWJzdGl0dXRpb25zKTtcblxuICAgICAgICBjb25zZXF1ZW5jZVN0YXRlbWVudE5vZGVNYXRjaGVzID0gY29uc2VxdWVuY2VNZXRhVmFyaWFibGVNYXRjaGVzOyAvLy9cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29uc2VxdWVuY2VTdGF0ZW1lbnROb2RlTWF0Y2hlcztcbn1cbiJdLCJuYW1lcyI6WyJDb25zZXF1ZW5jZSIsInN0YXRlbWVudE5vZGUiLCJnZXRTdGF0ZW1lbnROb2RlIiwibWF0Y2hTdGF0ZW1lbnROb2RlIiwibWV0YVN1YnN0aXR1dGlvbnMiLCJub25UZXJtaW5hbE5vZGUiLCJjb25zZXF1ZW5jZU5vblRlcm1pbmFsTm9kZSIsImNvbnNlcXVlbmNlTm9uVGVybWluYWxOb2RlTWF0Y2hlcyIsIm1hdGNoQ29uc2VxdWVuY2VOb25UZXJtaW5hbE5vZGUiLCJzdGF0ZW1lbnROb2RlTWF0Y2hlcyIsInRvSlNPTiIsInN0YXRlbWVudFN0cmluZyIsIm5vZGVBc1N0cmluZyIsInN0YXRlbWVudCIsImpzb24iLCJmcm9tSlNPTiIsInJlbGVhc2VDb250ZXh0Iiwic3RhdGVtZW50Tm9kZUZyb21TdGF0ZW1lbnRTdHJpbmciLCJjb25zZXF1ZW5jZSIsImZyb21TdGF0ZW1lbnROb2RlIiwibWF0Y2hDb25zZXF1ZW5jZU5vZGUiLCJjb25zZXF1ZW5jZU5vZGUiLCJub2RlIiwiY29uc2VxdWVuY2VOb2RlTWF0Y2hlcyIsIm5vZGVUZXJtaW5hbE5vZGUiLCJpc1Rlcm1pbmFsTm9kZSIsInJ1bGVOb2RlVGVybWluYWxOb2RlIiwidGVybWluYWxOb2RlIiwiY29uc2VxdWVuY2VUZXJtaW5hbE5vZGUiLCJjb25zZXF1ZW5jZVRlcm1pbmFsTm9kZU1hdGNoZXMiLCJtYXRjaENvbnNlcXVlbmNlVGVybWluYWxOb2RlIiwibWF0Y2hDb25zZXF1ZW5jZU5vZGVzIiwiY29uc2VxdWVuY2VOb2RlcyIsIm5vZGVzIiwiY29uc2VxdWVuY2VOb2Rlc01hdGNoZXMiLCJub2Rlc0xlbmd0aCIsImxlbmd0aCIsImNvbnNlcXVlbmNlTm9kZXNMZW5ndGgiLCJldmVyeSIsImluZGV4IiwibWF0Y2hDb25zZXF1ZW5jZVZhcmlhYmxlIiwiY29uc2VxdWVuY2VWYXJpYWJsZU5vZGUiLCJjb25zZXF1ZW5jZVZhcmlhYmxlTWF0Y2hlcyIsImNvbnNlcXVlbmNlVmFyaWFibGVOYW1lIiwidmFyaWFibGVOYW1lRnJvbVZhcmlhYmxlTm9kZSIsIm1ldGFTdWJzdGl0dXRpb24iLCJmaW5kIiwidmFyaWFibGVOYW1lIiwiZ2V0VmFyaWFibGVOYW1lIiwibWV0YVN1YnN0aXR1dGlvbk5vZGVzTWF0Y2giLCJtYXRjaE5vZGVzIiwibWF0Y2hlcyIsIm1hdGNoIiwicnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsImNvbnNlcXVlbmNlUnVsZU5hbWUiLCJjaGlsZE5vZGVzIiwiZ2V0Q2hpbGROb2RlcyIsImNvbnNlcXVlbmNlQ2hpbGROb2RlcyIsImNvbnNlcXVlbmNlQ2hpbGROb2Rlc01hdGNoZXMiLCJydWxlTmFtZVN0YXRlbWVudFJ1bGVOYW1lIiwiU1RBVEVNRU5UX1JVTEVfTkFNRSIsImNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZSIsImNvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZU1hdGNoZXMiLCJtYXRjaENvbnNlcXVlbmNlU3RhdGVtZW50Tm9kZSIsImNvbnNlcXVlbmNlQ2hpbGROb2Rlc0xlbmd0aCIsImZpcnN0Q29uc2VxdWVuY2VDaGlsZE5vZGUiLCJmaXJzdCIsImNvbnNlcXVlbmNlQ2hpbGROb2RlIiwiY29uc2VxdWVuY2VDaGlsZE5vZGVOb25UZXJtaW5hbE5vZGUiLCJpc05vblRlcm1pbmFsTm9kZSIsImNvbnNlcXVlbmNlTm9uVGVybWluYWxDaGlsZE5vZGUiLCJjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWUiLCJjb25zZXF1ZW5jZU5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWVWYXJpYWJsZVJ1bGVOYW1lIiwiVkFSSUFCTEVfUlVMRV9OQU1FIiwiY29uc2VxdWVuY2VNZXRhVmFyaWFibGVNYXRjaGVzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztlQVFxQkE7OztxQkFOQztzQkFDTztxQkFDZ0I7eUJBRVc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXpDLElBQUEsQUFBTUEsNEJBNENsQixBQTVDWTthQUFNQSxZQUNQQyxhQUFhOzhCQURORDtRQUVqQixJQUFJLENBQUNDLGFBQWEs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