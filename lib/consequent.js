"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return Consequent;
    }
});
var _array = require("./utilities/array");
var _string = require("./utilities/string");
var _query = require("./utilities/query");
var _ruleNames = require("./ruleNames");
function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}
function _defineProperties(target, props) {
    for(var i = 0; i < props.length; i++){
        var descriptor = props[i];
        descriptor.enumerable = descriptor.enumerable || false;
        descriptor.configurable = true;
        if ("value" in descriptor) descriptor.writable = true;
        Object.defineProperty(target, descriptor.key, descriptor);
    }
}
function _createClass(Constructor, protoProps, staticProps) {
    if (protoProps) _defineProperties(Constructor.prototype, protoProps);
    if (staticProps) _defineProperties(Constructor, staticProps);
    return Constructor;
}
var Consequent = /*#__PURE__*/ function() {
    function Consequent(statementNode) {
        _classCallCheck(this, Consequent);
        this.statementNode = statementNode;
    }
    _createClass(Consequent, [
        {
            key: "getStatementNode",
            value: function getStatementNode() {
                return this.statementNode;
            }
        },
        {
            key: "matchStatementNode",
            value: function matchStatementNode(statementNode, metaSubstitutions) {
                var nonTerminalNode = statementNode, consequentNonTerminalNode = this.statementNode, consequentNonTerminalNodeMatches = matchConsequentNonTerminalNode(consequentNonTerminalNode, nonTerminalNode, metaSubstitutions), statementNodeMatches = consequentNonTerminalNodeMatches; ///
                return statementNodeMatches;
            }
        },
        {
            key: "toJSON",
            value: function toJSON() {
                var statementString = (0, _string.nodeAsString)(this.statementNode), statement = statementString, json = {
                    statement: statement
                };
                return json;
            }
        }
    ], [
        {
            key: "fromJSON",
            value: function fromJSON(json, releaseContext) {
                var statement = json.statement, statementString = statement, statementNode = (0, _string.statementNodeFromStatementString)(statementString, releaseContext), consequent = new Consequent(statementNode);
                return consequent;
            }
        },
        {
            key: "fromStatementNode",
            value: function fromStatementNode(statementNode) {
                var consequent = new Consequent(statementNode);
                return consequent;
            }
        }
    ]);
    return Consequent;
}();
function matchConsequentNode(consequentNode, node, metaSubstitutions) {
    var consequentNodeMatches = false;
    var nodeTerminalNode = node.isTerminalNode(), ruleNodeTerminalNode = consequentNode.isTerminalNode();
    if (nodeTerminalNode === ruleNodeTerminalNode) {
        if (nodeTerminalNode) {
            var terminalNode = node, consequentTerminalNode = consequentNode, consequentTerminalNodeMatches = matchConsequentTerminalNode(consequentTerminalNode, terminalNode, metaSubstitutions);
            consequentNodeMatches = consequentTerminalNodeMatches; ///
        } else {
            var nonTerminalNode = node, consequentNonTerminalNode = consequentNode, consequentNonTerminalNodeMatches = matchConsequentNonTerminalNode(consequentNonTerminalNode, nonTerminalNode, metaSubstitutions);
            consequentNodeMatches = consequentNonTerminalNodeMatches; ///
        }
    }
    return consequentNodeMatches;
}
function matchConsequentNodes(consequentNodes, nodes, metaSubstitutions) {
    var consequentNodesMatches = false;
    var nodesLength = nodes.length, consequentNodesLength = consequentNodes.length;
    if (nodesLength === consequentNodesLength) {
        consequentNodesMatches = nodes.every(function(node, index) {
            var consequentNode = consequentNodes[index], consequentNodeMatches = matchConsequentNode(consequentNode, node, metaSubstitutions);
            if (consequentNodeMatches) {
                return true;
            }
        });
    }
    return consequentNodesMatches;
}
function matchConsequentVariable(consequentVariableNode, nodes, metaSubstitutions) {
    var consequentVariableMatches = true;
    var consequentVariableName = (0, _query.variableNameFromVariableNode)(consequentVariableNode), metaSubstitution = metaSubstitutions.find(function(metaSubstitution) {
        var variableName = metaSubstitution.getVariableName();
        if (variableName === consequentVariableName) {
            return true;
        }
    }) || null;
    if (metaSubstitution !== null) {
        var metaSubstitutionNodesMatch = metaSubstitution.matchNodes(nodes);
        consequentVariableMatches = metaSubstitutionNodesMatch; ///
    }
    return consequentVariableMatches;
}
function matchConsequentTerminalNode(consequentTerminalNode, terminalNode, metaSubstitutions) {
    var matches = consequentTerminalNode.match(terminalNode), consequentTerminalNodeMatches = matches; ///
    return consequentTerminalNodeMatches;
}
function matchConsequentNonTerminalNode(consequentNonTerminalNode, nonTerminalNode, metaSubstitutions) {
    var consequentNonTerminalNodeMatches = false;
    var ruleName = nonTerminalNode.getRuleName(), consequentRuleName = consequentNonTerminalNode.getRuleName(); ///
    if (ruleName === consequentRuleName) {
        var childNodes = nonTerminalNode.getChildNodes(), consequentChildNodes = consequentNonTerminalNode.getChildNodes(), nodes = childNodes, consequentNodes = consequentChildNodes, consequentChildNodesMatches = matchConsequentNodes(consequentNodes, nodes, metaSubstitutions);
        consequentNonTerminalNodeMatches = consequentChildNodesMatches; ///
        if (!consequentNonTerminalNodeMatches) {
            var ruleNameStatementRuleName = ruleName === _ruleNames.STATEMENT_RULE_NAME;
            if (ruleNameStatementRuleName) {
                var statementNode = nonTerminalNode, consequentStatementNode = consequentNonTerminalNode, consequentStatementNodeMatches = matchConsequentStatementNode(consequentStatementNode, statementNode, metaSubstitutions);
                consequentNonTerminalNodeMatches = consequentStatementNodeMatches; ///
            }
        }
    }
    return consequentNonTerminalNodeMatches;
}
function matchConsequentStatementNode(consequentStatementNode, statementNode, metaSubstitutions) {
    var consequentStatementNodeMatches = false;
    var consequentNonTerminalNode = consequentStatementNode, consequentChildNodes = consequentNonTerminalNode.getChildNodes(), consequentChildNodesLength = consequentChildNodes.length;
    if (consequentChildNodesLength === 1) {
        var firstConsequentChildNode = (0, _array.first)(consequentChildNodes), consequentChildNode = firstConsequentChildNode, consequentChildNodeNonTerminalNode = consequentChildNode.isNonTerminalNode();
        if (consequentChildNodeNonTerminalNode) {
            var consequentNonTerminalChildNode = consequentChildNode, consequentNonTerminalChildNodeRuleName = consequentNonTerminalChildNode.getRuleName(), consequentNonTerminalChildNodeRuleNameVariableRuleName = consequentNonTerminalChildNodeRuleName === _ruleNames.VARIABLE_RULE_NAME;
            if (consequentNonTerminalChildNodeRuleNameVariableRuleName) {
                var consequentVariableNode = consequentNonTerminalChildNode, nonTerminalNode = statementNode, childNodes = nonTerminalNode.getChildNodes(), nodes = childNodes, consequentMetaVariableMatches = matchConsequentVariable(consequentVariableNode, nodes, metaSubstitutions);
                consequentStatementNodeMatches = consequentMetaVariableMatches; ///
            }
        }
    }
    return consequentStatementNodeMatches;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jb25zZXF1ZW50LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBmaXJzdCB9IGZyb20gXCIuL3V0aWxpdGllcy9hcnJheVwiO1xuaW1wb3J0IHsgbm9kZUFzU3RyaW5nIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3N0cmluZ1wiO1xuaW1wb3J0IHsgdmFyaWFibGVOYW1lRnJvbVZhcmlhYmxlTm9kZSB9IGZyb20gXCIuL3V0aWxpdGllcy9xdWVyeVwiO1xuaW1wb3J0IHsgc3RhdGVtZW50Tm9kZUZyb21TdGF0ZW1lbnRTdHJpbmcgfSBmcm9tIFwiLi91dGlsaXRpZXMvc3RyaW5nXCI7XG5pbXBvcnQgeyBWQVJJQUJMRV9SVUxFX05BTUUsIFNUQVRFTUVOVF9SVUxFX05BTUUgfSBmcm9tIFwiLi9ydWxlTmFtZXNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29uc2VxdWVudCB7XG4gIGNvbnN0cnVjdG9yKHN0YXRlbWVudE5vZGUpIHtcbiAgICB0aGlzLnN0YXRlbWVudE5vZGUgPSBzdGF0ZW1lbnROb2RlO1xuICB9XG5cbiAgZ2V0U3RhdGVtZW50Tm9kZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZW1lbnROb2RlO1xuICB9XG5cbiAgbWF0Y2hTdGF0ZW1lbnROb2RlKHN0YXRlbWVudE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gc3RhdGVtZW50Tm9kZSwgIC8vL1xuICAgICAgICAgIGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGUgPSB0aGlzLnN0YXRlbWVudE5vZGUsICAvLy9cbiAgICAgICAgICBjb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlTWF0Y2hlcyA9IG1hdGNoQ29uc2VxdWVudE5vblRlcm1pbmFsTm9kZShjb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlLCBub25UZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKSxcbiAgICAgICAgICBzdGF0ZW1lbnROb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGVNYXRjaGVzOyAvLy9cblxuICAgIHJldHVybiBzdGF0ZW1lbnROb2RlTWF0Y2hlcztcbiAgfVxuXG4gIHRvSlNPTigpIHtcbiAgICBjb25zdCBzdGF0ZW1lbnRTdHJpbmcgPSBub2RlQXNTdHJpbmcodGhpcy5zdGF0ZW1lbnROb2RlKSxcbiAgICAgICAgICBzdGF0ZW1lbnQgPSBzdGF0ZW1lbnRTdHJpbmcsICAvLy9cbiAgICAgICAgICBqc29uID0ge1xuICAgICAgICAgICAgc3RhdGVtZW50XG4gICAgICAgICAgfTtcblxuICAgIHJldHVybiBqc29uO1xuICB9XG5cbiAgc3RhdGljIGZyb21KU09OKGpzb24sIHJlbGVhc2VDb250ZXh0KSB7XG4gICAgY29uc3QgeyBzdGF0ZW1lbnQgfSA9IGpzb24sXG4gICAgICAgICAgc3RhdGVtZW50U3RyaW5nID0gc3RhdGVtZW50LCAgLy8vXG4gICAgICAgICAgc3RhdGVtZW50Tm9kZSA9IHN0YXRlbWVudE5vZGVGcm9tU3RhdGVtZW50U3RyaW5nKHN0YXRlbWVudFN0cmluZywgcmVsZWFzZUNvbnRleHQpLFxuICAgICAgICAgIGNvbnNlcXVlbnQgPSBuZXcgQ29uc2VxdWVudChzdGF0ZW1lbnROb2RlKTtcblxuICAgIHJldHVybiBjb25zZXF1ZW50O1xuICB9XG5cbiAgc3RhdGljIGZyb21TdGF0ZW1lbnROb2RlKHN0YXRlbWVudE5vZGUpIHtcbiAgICBjb25zdCBjb25zZXF1ZW50ID0gbmV3IENvbnNlcXVlbnQoc3RhdGVtZW50Tm9kZSk7XG5cbiAgICByZXR1cm4gY29uc2VxdWVudDtcbiAgfVxufVxuXG5mdW5jdGlvbiBtYXRjaENvbnNlcXVlbnROb2RlKGNvbnNlcXVlbnROb2RlLCBub2RlLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVudE5vZGVNYXRjaGVzID0gZmFsc2U7XG5cbiAgY29uc3Qgbm9kZVRlcm1pbmFsTm9kZSA9IG5vZGUuaXNUZXJtaW5hbE5vZGUoKSxcbiAgICAgICAgcnVsZU5vZGVUZXJtaW5hbE5vZGUgPSBjb25zZXF1ZW50Tm9kZS5pc1Rlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlVGVybWluYWxOb2RlID09PSBydWxlTm9kZVRlcm1pbmFsTm9kZSkge1xuICAgIGlmIChub2RlVGVybWluYWxOb2RlKSB7XG4gICAgICBjb25zdCB0ZXJtaW5hbE5vZGUgPSBub2RlLCAgLy8vXG4gICAgICAgICAgICBjb25zZXF1ZW50VGVybWluYWxOb2RlID0gY29uc2VxdWVudE5vZGUsICAvLy9cbiAgICAgICAgICAgIGNvbnNlcXVlbnRUZXJtaW5hbE5vZGVNYXRjaGVzID0gbWF0Y2hDb25zZXF1ZW50VGVybWluYWxOb2RlKGNvbnNlcXVlbnRUZXJtaW5hbE5vZGUsIHRlcm1pbmFsTm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgICBjb25zZXF1ZW50Tm9kZU1hdGNoZXMgPSBjb25zZXF1ZW50VGVybWluYWxOb2RlTWF0Y2hlczsgIC8vL1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICAgIGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGUgPSBjb25zZXF1ZW50Tm9kZSwgIC8vL1xuICAgICAgICAgICAgY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZU1hdGNoZXMgPSBtYXRjaENvbnNlcXVlbnROb25UZXJtaW5hbE5vZGUoY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZSwgbm9uVGVybWluYWxOb2RlLCBtZXRhU3Vic3RpdHV0aW9ucyk7XG5cbiAgICAgIGNvbnNlcXVlbnROb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGVNYXRjaGVzOyAvLy9cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29uc2VxdWVudE5vZGVNYXRjaGVzO1xufVxuXG5mdW5jdGlvbiBtYXRjaENvbnNlcXVlbnROb2Rlcyhjb25zZXF1ZW50Tm9kZXMsIG5vZGVzLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVudE5vZGVzTWF0Y2hlcyA9IGZhbHNlO1xuXG4gIGNvbnN0IG5vZGVzTGVuZ3RoID0gbm9kZXMubGVuZ3RoLFxuICAgICAgICBjb25zZXF1ZW50Tm9kZXNMZW5ndGggPSBjb25zZXF1ZW50Tm9kZXMubGVuZ3RoO1xuXG4gIGlmIChub2Rlc0xlbmd0aCA9PT0gY29uc2VxdWVudE5vZGVzTGVuZ3RoKSB7XG4gICAgY29uc2VxdWVudE5vZGVzTWF0Y2hlcyA9IG5vZGVzLmV2ZXJ5KChub2RlLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY29uc2VxdWVudE5vZGUgPSBjb25zZXF1ZW50Tm9kZXNbaW5kZXhdLFxuICAgICAgICAgICAgY29uc2VxdWVudE5vZGVNYXRjaGVzID0gbWF0Y2hDb25zZXF1ZW50Tm9kZShjb25zZXF1ZW50Tm9kZSwgbm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgICBpZiAoY29uc2VxdWVudE5vZGVNYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIGNvbnNlcXVlbnROb2Rlc01hdGNoZXM7XG59XG5cbmZ1bmN0aW9uIG1hdGNoQ29uc2VxdWVudFZhcmlhYmxlKGNvbnNlcXVlbnRWYXJpYWJsZU5vZGUsIG5vZGVzLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVudFZhcmlhYmxlTWF0Y2hlcyA9IHRydWU7XG5cbiAgY29uc3QgY29uc2VxdWVudFZhcmlhYmxlTmFtZSA9IHZhcmlhYmxlTmFtZUZyb21WYXJpYWJsZU5vZGUoY29uc2VxdWVudFZhcmlhYmxlTm9kZSksXG4gICAgICAgIG1ldGFTdWJzdGl0dXRpb24gPSBtZXRhU3Vic3RpdHV0aW9ucy5maW5kKChtZXRhU3Vic3RpdHV0aW9uKSA9PiB7XG4gICAgICAgICAgY29uc3QgdmFyaWFibGVOYW1lID0gbWV0YVN1YnN0aXR1dGlvbi5nZXRWYXJpYWJsZU5hbWUoKTtcblxuICAgICAgICAgIGlmICh2YXJpYWJsZU5hbWUgPT09IGNvbnNlcXVlbnRWYXJpYWJsZU5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSkgfHwgbnVsbDtcblxuICBpZiAobWV0YVN1YnN0aXR1dGlvbiAhPT0gbnVsbCkge1xuICAgIGNvbnN0IG1ldGFTdWJzdGl0dXRpb25Ob2Rlc01hdGNoID0gbWV0YVN1YnN0aXR1dGlvbi5tYXRjaE5vZGVzKG5vZGVzKTtcblxuICAgIGNvbnNlcXVlbnRWYXJpYWJsZU1hdGNoZXMgPSBtZXRhU3Vic3RpdHV0aW9uTm9kZXNNYXRjaDsgIC8vL1xuICB9XG5cbiAgcmV0dXJuIGNvbnNlcXVlbnRWYXJpYWJsZU1hdGNoZXM7XG59XG5cbmZ1bmN0aW9uIG1hdGNoQ29uc2VxdWVudFRlcm1pbmFsTm9kZShjb25zZXF1ZW50VGVybWluYWxOb2RlLCB0ZXJtaW5hbE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKSB7XG4gIGNvbnN0IG1hdGNoZXMgPSBjb25zZXF1ZW50VGVybWluYWxOb2RlLm1hdGNoKHRlcm1pbmFsTm9kZSksXG4gICAgICAgIGNvbnNlcXVlbnRUZXJtaW5hbE5vZGVNYXRjaGVzID0gbWF0Y2hlczsgIC8vL1xuXG4gIHJldHVybiBjb25zZXF1ZW50VGVybWluYWxOb2RlTWF0Y2hlcztcbn1cblxuZnVuY3Rpb24gbWF0Y2hDb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlKGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGUsIG5vblRlcm1pbmFsTm9kZSwgbWV0YVN1YnN0aXR1dGlvbnMpIHtcbiAgbGV0IGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGVNYXRjaGVzID0gZmFsc2U7XG5cbiAgY29uc3QgcnVsZU5hbWUgPSBub25UZXJtaW5hbE5vZGUuZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgY29uc2VxdWVudFJ1bGVOYW1lID0gY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZS5nZXRSdWxlTmFtZSgpOyAvLy9cblxuICBpZiAocnVsZU5hbWUgPT09IGNvbnNlcXVlbnRSdWxlTmFtZSkge1xuICAgIGNvbnN0IGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICAgIGNvbnNlcXVlbnRDaGlsZE5vZGVzID0gY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgICAgbm9kZXMgPSBjaGlsZE5vZGVzLCAvLy9cbiAgICAgICAgICBjb25zZXF1ZW50Tm9kZXMgPSBjb25zZXF1ZW50Q2hpbGROb2RlcywgLy8vXG4gICAgICAgICAgY29uc2VxdWVudENoaWxkTm9kZXNNYXRjaGVzID0gbWF0Y2hDb25zZXF1ZW50Tm9kZXMoY29uc2VxdWVudE5vZGVzLCBub2RlcywgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZU1hdGNoZXMgPSBjb25zZXF1ZW50Q2hpbGROb2Rlc01hdGNoZXM7IC8vL1xuXG4gICAgaWYgKCFjb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlTWF0Y2hlcykge1xuICAgICAgY29uc3QgcnVsZU5hbWVTdGF0ZW1lbnRSdWxlTmFtZSA9IChydWxlTmFtZSA9PT0gU1RBVEVNRU5UX1JVTEVfTkFNRSk7XG5cbiAgICAgIGlmIChydWxlTmFtZVN0YXRlbWVudFJ1bGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlbWVudE5vZGUgPSBub25UZXJtaW5hbE5vZGUsICAvLy9cbiAgICAgICAgICAgICAgY29uc2VxdWVudFN0YXRlbWVudE5vZGUgPSBjb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlLCAgLy8vXG4gICAgICAgICAgICAgIGNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlTWF0Y2hlcyA9IG1hdGNoQ29uc2VxdWVudFN0YXRlbWVudE5vZGUoY29uc2VxdWVudFN0YXRlbWVudE5vZGUsIHN0YXRlbWVudE5vZGUsIG1ldGFTdWJzdGl0dXRpb25zKTtcblxuICAgICAgICBjb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlTWF0Y2hlczsgLy8vXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGVNYXRjaGVzO1xufVxuXG5mdW5jdGlvbiBtYXRjaENvbnNlcXVlbnRTdGF0ZW1lbnROb2RlKGNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlLCBzdGF0ZW1lbnROb2RlLCBtZXRhU3Vic3RpdHV0aW9ucykge1xuICBsZXQgY29uc2VxdWVudFN0YXRlbWVudE5vZGVNYXRjaGVzID0gZmFsc2U7XG5cbiAgY29uc3QgY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZSA9IGNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlLCAgLy8vXG4gICAgICAgIGNvbnNlcXVlbnRDaGlsZE5vZGVzID0gY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgIGNvbnNlcXVlbnRDaGlsZE5vZGVzTGVuZ3RoID0gY29uc2VxdWVudENoaWxkTm9kZXMubGVuZ3RoO1xuXG4gIGlmIChjb25zZXF1ZW50Q2hpbGROb2Rlc0xlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IGZpcnN0Q29uc2VxdWVudENoaWxkTm9kZSA9IGZpcnN0KGNvbnNlcXVlbnRDaGlsZE5vZGVzKSxcbiAgICAgICAgICBjb25zZXF1ZW50Q2hpbGROb2RlID0gZmlyc3RDb25zZXF1ZW50Q2hpbGROb2RlLCAgLy8vXG4gICAgICAgICAgY29uc2VxdWVudENoaWxkTm9kZU5vblRlcm1pbmFsTm9kZSA9IGNvbnNlcXVlbnRDaGlsZE5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICAgIGlmIChjb25zZXF1ZW50Q2hpbGROb2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgICBjb25zdCBjb25zZXF1ZW50Tm9uVGVybWluYWxDaGlsZE5vZGUgPSBjb25zZXF1ZW50Q2hpbGROb2RlLCAgLy8vXG4gICAgICAgICAgICBjb25zZXF1ZW50Tm9uVGVybWluYWxDaGlsZE5vZGVSdWxlTmFtZSA9IGNvbnNlcXVlbnROb25UZXJtaW5hbENoaWxkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgY29uc2VxdWVudE5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWVWYXJpYWJsZVJ1bGVOYW1lID0gKGNvbnNlcXVlbnROb25UZXJtaW5hbENoaWxkTm9kZVJ1bGVOYW1lID09PSBWQVJJQUJMRV9SVUxFX05BTUUpO1xuXG4gICAgICBpZiAoY29uc2VxdWVudE5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWVWYXJpYWJsZVJ1bGVOYW1lKSB7XG4gICAgICAgIGNvbnN0IGNvbnNlcXVlbnRWYXJpYWJsZU5vZGUgPSBjb25zZXF1ZW50Tm9uVGVybWluYWxDaGlsZE5vZGUsICAvLy9cbiAgICAgICAgICAgICAgbm9uVGVybWluYWxOb2RlID0gc3RhdGVtZW50Tm9kZSwgIC8vL1xuICAgICAgICAgICAgICBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKSxcbiAgICAgICAgICAgICAgbm9kZXMgPSBjaGlsZE5vZGVzLCAvLy9cbiAgICAgICAgICAgICAgY29uc2VxdWVudE1ldGFWYXJpYWJsZU1hdGNoZXMgPSBtYXRjaENvbnNlcXVlbnRWYXJpYWJsZShjb25zZXF1ZW50VmFyaWFibGVOb2RlLCBub2RlcywgbWV0YVN1YnN0aXR1dGlvbnMpO1xuXG4gICAgICAgIGNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlTWF0Y2hlcyA9IGNvbnNlcXVlbnRNZXRhVmFyaWFibGVNYXRjaGVzOyAvLy9cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gY29uc2VxdWVudFN0YXRlbWVudE5vZGVNYXRjaGVzO1xufVxuIl0sIm5hbWVzIjpbIkNvbnNlcXVlbnQiLCJzdGF0ZW1lbnROb2RlIiwiZ2V0U3RhdGVtZW50Tm9kZSIsIm1hdGNoU3RhdGVtZW50Tm9kZSIsIm1ldGFTdWJzdGl0dXRpb25zIiwibm9uVGVybWluYWxOb2RlIiwiY29uc2VxdWVudE5vblRlcm1pbmFsTm9kZSIsImNvbnNlcXVlbnROb25UZXJtaW5hbE5vZGVNYXRjaGVzIiwibWF0Y2hDb25zZXF1ZW50Tm9uVGVybWluYWxOb2RlIiwic3RhdGVtZW50Tm9kZU1hdGNoZXMiLCJ0b0pTT04iLCJzdGF0ZW1lbnRTdHJpbmciLCJub2RlQXNTdHJpbmciLCJzdGF0ZW1lbnQiLCJqc29uIiwiZnJvbUpTT04iLCJyZWxlYXNlQ29udGV4dCIsInN0YXRlbWVudE5vZGVGcm9tU3RhdGVtZW50U3RyaW5nIiwiY29uc2VxdWVudCIsImZyb21TdGF0ZW1lbnROb2RlIiwibWF0Y2hDb25zZXF1ZW50Tm9kZSIsImNvbnNlcXVlbnROb2RlIiwibm9kZSIsImNvbnNlcXVlbnROb2RlTWF0Y2hlcyIsIm5vZGVUZXJtaW5hbE5vZGUiLCJpc1Rlcm1pbmFsTm9kZSIsInJ1bGVOb2RlVGVybWluYWxOb2RlIiwidGVybWluYWxOb2RlIiwiY29uc2VxdWVudFRlcm1pbmFsTm9kZSIsImNvbnNlcXVlbnRUZXJtaW5hbE5vZGVNYXRjaGVzIiwibWF0Y2hDb25zZXF1ZW50VGVybWluYWxOb2RlIiwibWF0Y2hDb25zZXF1ZW50Tm9kZXMiLCJjb25zZXF1ZW50Tm9kZXMiLCJub2RlcyIsImNvbnNlcXVlbnROb2Rlc01hdGNoZXMiLCJub2Rlc0xlbmd0aCIsImxlbmd0aCIsImNvbnNlcXVlbnROb2Rlc0xlbmd0aCIsImV2ZXJ5IiwiaW5kZXgiLCJtYXRjaENvbnNlcXVlbnRWYXJpYWJsZSIsImNvbnNlcXVlbnRWYXJpYWJsZU5vZGUiLCJjb25zZXF1ZW50VmFyaWFibGVNYXRjaGVzIiwiY29uc2VxdWVudFZhcmlhYmxlTmFtZSIsInZhcmlhYmxlTmFtZUZyb21WYXJpYWJsZU5vZGUiLCJtZXRhU3Vic3RpdHV0aW9uIiwiZmluZCIsInZhcmlhYmxlTmFtZSIsImdldFZhcmlhYmxlTmFtZSIsIm1ldGFTdWJzdGl0dXRpb25Ob2Rlc01hdGNoIiwibWF0Y2hOb2RlcyIsIm1hdGNoZXMiLCJtYXRjaCIsInJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJjb25zZXF1ZW50UnVsZU5hbWUiLCJjaGlsZE5vZGVzIiwiZ2V0Q2hpbGROb2RlcyIsImNvbnNlcXVlbnRDaGlsZE5vZGVzIiwiY29uc2VxdWVudENoaWxkTm9kZXNNYXRjaGVzIiwicnVsZU5hbWVTdGF0ZW1lbnRSdWxlTmFtZSIsIlNUQVRFTUVOVF9SVUxFX05BTUUiLCJjb25zZXF1ZW50U3RhdGVtZW50Tm9kZSIsImNvbnNlcXVlbnRTdGF0ZW1lbnROb2RlTWF0Y2hlcyIsIm1hdGNoQ29uc2VxdWVudFN0YXRlbWVudE5vZGUiLCJjb25zZXF1ZW50Q2hpbGROb2Rlc0xlbmd0aCIsImZpcnN0Q29uc2VxdWVudENoaWxkTm9kZSIsImZpcnN0IiwiY29uc2VxdWVudENoaWxkTm9kZSIsImNvbnNlcXVlbnRDaGlsZE5vZGVOb25UZXJtaW5hbE5vZGUiLCJpc05vblRlcm1pbmFsTm9kZSIsImNvbnNlcXVlbnROb25UZXJtaW5hbENoaWxkTm9kZSIsImNvbnNlcXVlbnROb25UZXJtaW5hbENoaWxkTm9kZVJ1bGVOYW1lIiwiY29uc2VxdWVudE5vblRlcm1pbmFsQ2hpbGROb2RlUnVsZU5hbWVWYXJpYWJsZVJ1bGVOYW1lIiwiVkFSSUFCTEVfUlVMRV9OQU1FIiwiY29uc2VxdWVudE1ldGFWYXJpYWJsZU1hdGNoZXMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O2VBUXFCQTs7O3FCQU5DO3NCQUNPO3FCQUNnQjt5QkFFVzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFekMsSUFBQSxBQUFNQSwyQkE0Q2xCLEFBNUNZO2FBQU1BLFdBQ1BDLGFBQWE7OEJBRE5EO1FBRWpCLElBQUksQ0FBQ0MsYUFBYSxHQUFHQTs7aUJBRkpEOztZQUtuQkUsS0FBQUE7bUJBQUFBLFNBQUFBLG1CQUFtQjtnQkFDakIsT0FBTyxJQUFJLENBQUNELGFBQWE7WUFDM0I7OztZQUVBRSxLQUFBQTttQkFBQUEsU0FBQUEsbUJBQW1CRixhQUFhLEVBQUVHLGlCQUFpQixFQUFFO2dCQUNuRCxJ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